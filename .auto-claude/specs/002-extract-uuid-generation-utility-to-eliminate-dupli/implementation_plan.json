{
  "feature": "Extract UUID generation utility to eliminate duplication",
  "description": "UUID generation logic is duplicated in two places: `google-auth.ts` has a `generateUUID()` function (lines 109-114), and `google-calendar-backend.ts` has inline UUID generation with a fallback pattern (lines 288-293). The calendar backend even implements a fallback for `crypto.randomUUID` that the auth module's version doesn't have.",
  "created_at": "2025-12-31T16:16:02.352Z",
  "updated_at": "2025-12-31T21:39:52.472Z",
  "status": "done",
  "planStatus": "completed",
  "phases": [
    {
      "id": "phase-1",
      "name": "Create UUID Utility Module",
      "description": "Create a centralized UUID generation utility with proper fallback support",
      "status": "pending",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create src/lib/uuid.ts utility module",
          "description": "Create new utility file with generateUUID() function that uses crypto.randomUUID with fallback to manual implementation for older environments",
          "status": "completed",
          "files": [
            "src/lib/uuid.ts"
          ],
          "acceptance_criteria": [
            "Function uses crypto.randomUUID when available",
            "Falls back to manual UUID v4 generation when crypto.randomUUID is unavailable",
            "Returns valid UUID v4 format string",
            "Properly typed with TypeScript"
          ]
        },
        {
          "id": "1.2",
          "title": "Add unit tests for UUID utility",
          "description": "Create test file to verify UUID generation works correctly in both paths",
          "status": "completed",
          "files": [
            "src/lib/tests/uuid.test.ts"
          ],
          "acceptance_criteria": [
            "Tests verify output matches UUID v4 format",
            "Tests verify uniqueness of generated UUIDs",
            "All tests pass"
          ]
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Replace Duplicate Implementations",
      "description": "Update all files that duplicate UUID logic to use the new centralized utility",
      "status": "pending",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Update google-auth.ts to use UUID utility",
          "description": "Remove local generateUUID() function and import from uuid.ts instead",
          "status": "completed",
          "files": [
            "src/lib/backends/google-auth.ts"
          ],
          "acceptance_criteria": [
            "Local generateUUID function is removed",
            "Imports generateUUID from '../uuid'",
            "getUserId() function continues to work correctly"
          ]
        },
        {
          "id": "2.2",
          "title": "Update google-calendar-backend.ts to use UUID utility",
          "description": "Replace inline UUID generation with import from uuid.ts",
          "status": "completed",
          "files": [
            "src/lib/backends/google-calendar-backend.ts"
          ],
          "acceptance_criteria": [
            "Inline UUID generation code is removed",
            "Imports generateUUID from '../uuid'",
            "quickAddEvent() function continues to work correctly"
          ]
        },
        {
          "id": "2.3",
          "title": "Update localstorage-backend.ts to use UUID utility",
          "description": "Replace direct crypto.randomUUID() call with centralized utility for consistency",
          "status": "completed",
          "files": [
            "src/lib/backends/localstorage-backend.ts"
          ],
          "acceptance_criteria": [
            "Direct crypto.randomUUID() call is replaced",
            "Imports generateUUID from '../uuid'",
            "addTask() function continues to work correctly"
          ]
        },
        {
          "id": "2.4",
          "title": "Update todoist-backend.ts to use UUID utility",
          "description": "Replace all 5 direct crypto.randomUUID() calls with centralized utility",
          "status": "completed",
          "files": [
            "src/lib/backends/todoist-backend.ts"
          ],
          "acceptance_criteria": [
            "All 5 crypto.randomUUID() calls are replaced",
            "Imports generateUUID from '../uuid'",
            "All command methods continue to work correctly"
          ]
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Verification",
      "description": "Run tests and verify the refactoring is complete",
      "status": "pending",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Run all tests",
          "description": "Execute npm test to ensure all existing tests still pass",
          "status": "completed",
          "files": [],
          "acceptance_criteria": [
            "All existing tests pass",
            "New UUID tests pass",
            "No TypeScript errors"
          ]
        },
        {
          "id": "3.2",
          "title": "Verify no duplicate UUID logic remains",
          "description": "Search codebase to confirm all UUID generation uses the centralized utility",
          "status": "pending",
          "files": [],
          "acceptance_criteria": [
            "No manual UUID generation code outside uuid.ts",
            "All backends import from uuid.ts",
            "No direct crypto.randomUUID calls in backend files"
          ]
        }
      ]
    }
  ],
  "workflow_type": "development",
  "services_involved": [
    "src/lib/uuid.ts",
    "src/lib/backends/google-auth.ts",
    "src/lib/backends/google-calendar-backend.ts",
    "src/lib/backends/localstorage-backend.ts",
    "src/lib/backends/todoist-backend.ts"
  ],
  "final_acceptance": [
    "Single source of truth for UUID generation in src/lib/uuid.ts",
    "All backends use the centralized utility",
    "Fallback for crypto.randomUUID is implemented",
    "All tests pass",
    "No duplicate UUID generation code"
  ],
  "spec_file": "spec.md"
}